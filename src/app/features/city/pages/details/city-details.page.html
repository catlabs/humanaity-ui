<div class="city-details-page">
  <mat-drawer-container
    class="city-details-page__drawer-container app-drawer-content-transparent"
    autosize
  >
    <mat-drawer
      position="end"
      [mode]="drawerMode()"
      [opened]="drawerOpen()"
      (openedChange)="drawerOpen.set($event)"
      class="city-details-page__drawer app-main-bg app-drawer-flat"
    >
      <div class="city-details-page__drawer-content">
        <mat-card class="city-details-page__drawer-card">
          <div class="city-details-page__drawer-header">
            <h3 class="city-details-page__drawer-title">Recent Events</h3>
            <button
              mat-icon-button
              type="button"
              class="city-details-page__drawer-close-button"
              (click)="closeDrawer()"
              aria-label="Collapse sidebar"
            >
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <div class="city-details-page__drawer-body">
            @for (event of recentEvents(); track event.id) {
            <app-event-item
              [title]="event.title"
              [description]="event.description"
              [timestamp]="event.timestamp"
              [type]="event.type"
            >
            </app-event-item>
            } @empty {
            <div class="city-details-page__drawer-empty">No recent events</div>
            }
          </div>
        </mat-card>
      </div>
    </mat-drawer>

    <mat-drawer-content class="city-details-page__content">
      <div class="city-details-page__main">
        <!-- City Context Header -->
        <div class="city-details-page__header">
          <div class="city-details-page__title-section">
            <h2 class="city-details-page__title">
              {{ city.name }}
            </h2>
            <span class="city-details-page__cycle"> Cycle {{ cycle() }} </span>
          </div>

          <div class="city-details-page__actions">
            <button
              mat-raised-button
              color="primary"
              class="city-details-page__action-button"
              (click)="onStart()"
              [disabled]="isRunning()"
            >
              <mat-icon>play_arrow</mat-icon>
              <span>Start</span>
            </button>
            <button
              mat-raised-button
              class="city-details-page__action-button surface-button"
              (click)="onPause()"
              [disabled]="!isRunning()"
            >
              <mat-icon>pause</mat-icon>
              <span>Pause</span>
            </button>
            <button
              mat-raised-button
              color="primary"
              class="city-details-page__action-button"
              (click)="onStep(1)"
            >
              <mat-icon>skip_next</mat-icon>
              <span>+1</span>
            </button>
            <button
              mat-raised-button
              color="primary"
              class="city-details-page__action-button"
              (click)="onStep(10)"
            >
              <mat-icon>fast_forward</mat-icon>
              <span>+10</span>
            </button>
          </div>
        </div>

        <!-- Map Container -->
        <div class="city-details-page__map-container">
          <div class="city-details-page__map-wrapper">
            <div #container class="city-details-page__map"></div>

            <!-- Map Stats Overlay -->
            <div class="city-details-page__map-overlay">
              <div class="city-details-page__map-stat">
                <div class="city-details-page__map-stat-label">Population</div>
                <div class="city-details-page__map-stat-value">
                  {{ population() }}
                </div>
              </div>
              <div class="city-details-page__map-divider"></div>
              <div class="city-details-page__map-stat">
                <div class="city-details-page__map-stat-label">Happiness</div>
                <div
                  class="city-details-page__map-stat-value"
                  style="color: #a7f3d0"
                >
                  {{ happiness() }}%
                </div>
              </div>
              <div class="city-details-page__map-divider"></div>
              <div class="city-details-page__map-stat">
                <div class="city-details-page__map-stat-label">Resources</div>
                <div
                  class="city-details-page__map-stat-value"
                  style="color: #fde68a"
                >
                  {{ resources() }}
                </div>
              </div>
            </div>

            <!-- Map Controls -->
            <div class="city-details-page__map-controls">
              @if (!drawerOpen()) {
              <button
                mat-icon-button
                type="button"
                class="city-details-page__map-control-button"
                (click)="openDrawer()"
                aria-label="Open sidebar"
              >
                <mat-icon>chevron_left</mat-icon>
              </button>
              }

              <button
                mat-icon-button
                class="city-details-page__map-control-button"
              >
                <mat-icon>add</mat-icon>
              </button>
              <button
                mat-icon-button
                class="city-details-page__map-control-button"
              >
                <mat-icon>remove</mat-icon>
              </button>
              <button
                mat-icon-button
                class="city-details-page__map-control-button"
              >
                <mat-icon>fullscreen</mat-icon>
              </button>
            </div>

            <!-- Grid Info -->
            <div class="city-details-page__map-info">Grid: 100x100</div>
          </div>
        </div>
      </div>
    </mat-drawer-content>
  </mat-drawer-container>
</div>
