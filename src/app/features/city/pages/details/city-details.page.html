<div class="flex min-h-screen flex-col bg-surface">
  <!-- City Context Header -->
  <div class="sticky top-16 z-40 border-b border-outlineVariant bg-surface">
    <app-container class="h-12">
      <div class="flex h-full items-center justify-between">
        <div class="flex items-center gap-3">
          <h2 class="text-base font-semibold text-onSurface">{{ city.name }}</h2>
          <span class="text-xs text-onSurfaceVariant">Cycle {{ cycle() }}</span>
      </div>
      
        <div class="flex items-center gap-6">
          <div class="flex items-center gap-2 text-sm font-medium text-onSurfaceVariant">
            <a class="rounded-md px-3 py-1.5 text-primary bg-primaryContainer">Simulation</a>
            <a class="rounded-md px-3 py-1.5 hover:text-onSurface">Humans</a>
            <a class="rounded-md px-3 py-1.5 hover:text-onSurface">Places</a>
            <a class="rounded-md px-3 py-1.5 hover:text-onSurface">Inventions</a>
            <a class="rounded-md px-3 py-1.5 hover:text-onSurface">Logs</a>
        </div>
        
          <div class="flex items-center gap-2">
            <button
              mat-raised-button
              color="primary"
              class="flex items-center gap-1 px-4 py-2 text-sm font-semibold"
              (click)="onStart()"
              [disabled]="isRunning()">
            <mat-icon>play_arrow</mat-icon>
            <span>Start</span>
          </button>
            <button
              mat-raised-button
              class="flex items-center gap-1 px-4 py-2 text-sm font-semibold bg-surfaceContainerHigh text-onSurface hover:bg-surfaceContainerHighest"
              (click)="onPause()"
              [disabled]="!isRunning()">
            <mat-icon>pause</mat-icon>
            <span>Pause</span>
          </button>
            <button
              mat-raised-button
              color="primary"
              class="flex items-center gap-1 px-3 py-2 text-sm font-semibold"
              (click)="onStep(1)">
            <mat-icon>skip_next</mat-icon>
            <span>+1</span>
          </button>
            <button
              mat-raised-button
              color="primary"
              class="flex items-center gap-1 px-3 py-2 text-sm font-semibold"
              (click)="onStep(10)">
            <mat-icon>fast_forward</mat-icon>
            <span>+10</span>
          </button>
        </div>
      </div>
    </div>
    </app-container>
  </div>

  <!-- Main Content -->
  <main class="flex-1 py-6">
    <app-container>
      <div class="grid gap-6 lg:grid-cols-[2fr_1fr]">
      <!-- Map Container -->
        <div class="overflow-hidden rounded-xl border border-outlineVariant bg-surfaceContainerLowest shadow-sm">
          <div class="relative aspect-[16/9]">
            <div #container class="h-full w-full"></div>
          
          <!-- Map Stats Overlay -->
            <div class="absolute inset-x-0 top-0 flex items-center gap-4 bg-gradient-to-b from-black/40 to-transparent p-4 text-white">
              <div class="flex items-center gap-2">
                <div class="text-xs uppercase tracking-wide text-white/80">Population</div>
                <div class="text-lg font-semibold">{{ population() }}</div>
              </div>
              <div class="h-6 w-px bg-white/30"></div>
              <div class="flex items-center gap-2">
                <div class="text-xs uppercase tracking-wide text-white/80">Happiness</div>
                <div class="text-lg font-semibold text-emerald-200">{{ happiness() }}%</div>
            </div>
              <div class="h-6 w-px bg-white/30"></div>
              <div class="flex items-center gap-2">
                <div class="text-xs uppercase tracking-wide text-white/80">Resources</div>
                <div class="text-lg font-semibold text-amber-200">{{ resources() }}</div>
            </div>
          </div>

          <!-- Map Controls -->
            <div class="absolute right-4 top-4 flex flex-col gap-2">
              <button mat-icon-button class="rounded-lg bg-surface/90 shadow hover:bg-surface">
              <mat-icon>add</mat-icon>
            </button>
              <button mat-icon-button class="rounded-lg bg-surface/90 shadow hover:bg-surface">
              <mat-icon>remove</mat-icon>
            </button>
              <button mat-icon-button class="rounded-lg bg-surface/90 shadow hover:bg-surface">
              <mat-icon>fullscreen</mat-icon>
            </button>
          </div>

          <!-- Grid Info -->
            <div class="absolute left-4 bottom-4 rounded-md bg-surface/90 px-3 py-1 text-sm font-medium text-onSurfaceVariant shadow">
              Grid: 100x100
          </div>
        </div>
      </div>

      <!-- Sidebar Panels -->
        <div class="flex flex-col gap-4">
        <!-- Recent Events Panel -->
          <mat-card class="border border-outlineVariant shadow-sm">
            <div class="border-b border-outlineVariant px-4 py-3">
              <h3 class="text-lg font-semibold text-onSurface">Recent Events</h3>
          </div>
            <div class="max-h-[480px] overflow-auto px-4 py-3">
            @for (event of recentEvents(); track event.id) {
              <app-event-item
                [title]="event.title"
                [description]="event.description"
                [timestamp]="event.timestamp"
                [type]="event.type">
              </app-event-item>
            } @empty {
                <div class="py-6 text-center text-onSurfaceVariant">No recent events</div>
            }
          </div>
        </mat-card>

        <!-- Selected Entity Panel -->
        @if (selectedEntity()) {
          <app-entity-panel
            [entity]="selectedEntity()!"
            (viewDetails)="onViewEntityDetails()">
          </app-entity-panel>
        }
      </div>
    </div>
    </app-container>
  </main>
</div>
